
    <div class="checkout_area pt-80">
        <div class="container">
            <div class="notification__message">
                <p><i class="fal fa-window-maximize"></i>Returning customer? Click here to <a href="login.html">login</a></p>
                <p><i class="fal fa-window-maximize"></i>Have a coupon? Click here to enter your code</p>
            </div>
            <div class="row">
                <div class="col-xl-7 col-lg-7 col-md-12">
                    <div class="checkout_form mb-100">
                        <!-- <form action="/place-order/<%= users._id %>" method="post"> -->
                            <form action="" id="checkoutForm">
                           
                            <div class="row mb-30">
                                <div class="col-xl-6 col-lg-6 col-md-6">
                                    <div class="checkout__wrap">
                                        <label>First name <span>*</span></label>
                                        <input type="text" name="fname" id="fname">
                                    </div>
                                </div>
                                <!-- <div class="col-xl-6 col-lg-6 col-md-6">
                                    <div class="checkout__wrap">
                                        <label>Last name <span>*</span></label>
                                        <input type="text" name="lname">
                                    </div>
                                </div> -->
                            </div>
                            <div class="checkout__wrap">
                                <label>Company name (optional) <span></span></label>
                                <input type="text" name="cname" id="companyname">
                            </div>
                            <!-- <div class="checkout__wrap">
                                <label>Country / Region <span>*</span></label>
                                <select name="country" required>
                                    <option value="Bangladesh">Bangladesh</option>
                                    <option value="Bangladesh">Pakistan</option>
                                    <option value="Bangladesh">Arab</option>
                                    <option value="Bangladesh">America</option>
                                    <option value="Bangladesh">Saudi Arabia</option>
                                    <option value="Bangladesh">Israil</option>
                                    <option value="Bangladesh">Irak</option>
                                    <option value="Bangladesh">Netherland</option>
                                </select>
                            </div> -->
                            <div class="checkout__wrap">
                                <label>Street address <span>*</span></label>
                                <input class="mb-20" type="text" name="add1" placeholder="house number and street number" id="streetAddress">
                               
                            </div>
                            <div class="checkout__wrap">
                                <label>Town / City *<span></span></label>
                                <input type="text" name="town" id="town">
                            </div>
                            <div class="checkout__wrap">
                                <label>County (optional)<span></span></label>
                                <input type="text" name="country" id="country">
                            </div>
                            <div class="checkout__wrap">
                                <label>Postcode<span>*</span></label>
                                <input type="text" name="postcode" id="postcode">
                            </div>
                            <div class="checkout__wrap">
                                <label>Phone <span>*</span></label>
                                <input type="text" name="phone" id="phone">
                            </div>
                            <div class="checkout__wrap">
                                <label>Email address <span>*</span></label>
                                <input type="email" name="email" id="email">
                                <input type="text" name="userID" id="" value="<%= users._id %>" hidden>
                            </div>
                            <div class="checkout__wrap-2 pt-20">
                                <input type="checkbox" name="check1">
                                <span>Create an account?</span>
                            </div>
                            <div class="checkout__wrap-2 pt-20">
                                <input type="checkbox" name="check2">
                                <span>Ship to a different address?</span>
                            </div>
                            <div class="checkout__wrap">
                                <label>Order notes (optional) <span></span></label>
                                <textarea  name="ordernote" placeholder="Note about your order, e.g special note for delivery"></textarea>
                            </div>

                          
                        
                    </div>
                </div>
            
                <div class="col-xl-5 col-lg-5 col-md-12">
                    <div class="cart__acount ml-50">
                        <h5>Your order</h5>
                      <table>
                        <% products.forEach(function(product, i){ %>
                          <tr class="first-child-2">
                              <td>product</td>
                              <td><%= product.products.shoename %><span></span></td>
                          </tr>
                          <tr class="first-child-2">
                              <td>price</td>
                              <td class="lightbluee"><%= product.products.price %></td>
                          </tr>
                          <% }); %> 
                          <tr class="first-child lastchild">
                              <td>Shipping</td>
                              <td>Enter your address to view shipping options. </td>
                          </tr>
                          <tr class="design-footer">
                        
                            <td>
                                <input type="text" placeholder="Coupon Code" id="code">
                                <input type="text" name="Total" id="price" value="<%= Total %>" hidden>
                                <input type="text" name="offerdata" id="offeramount" value="" hidden>
                              
                            </td>
                            <td><button type="button" class="badge bg-dark" style="border: none;" onclick="checkCoupon()">Apply Coupon</button></td>
                            <!-- <td colspan="3"><a href="#">update cart</a></td> -->
                        </tr>
                        
                          <tr class="first-child-2">
                              <td>Total</td>
                              <td class="lightbluee"><span id="offer"><%= Total %></span></td>
                          </tr>
                        
                      </table>
                    
                   
                      <div class="checkout__accordion mt-30">
                        <div class="accordion" id="accordionExample">
                            <div class="accordion-item">
                              <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    Check payments 
                                </button>
                              </h2>
                              <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    Please send a check to Store Name, Store Street, Store Town, Store State / County, Store Postcode.
                                </div>
                              </div>
                            </div>
                            <!-- <div class="accordion-item">
                              <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    Cash on delivery 
                                </button>
                              </h2>
                              <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    Pay with cash upon delivery.
                                </div>
                              </div>
                            </div> -->
                            <div class="accordion-item">
                              <!-- <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    PayPal
                                </button>
                              </h2> -->
                              <div class="payment-method">
                                <div class="pay-top sin-payment">
                                    <input id="payment-method-3" class="input-radio" type="radio" value="COD" name="payment_method">
                                    <label for="payment-method-3" style="color: black;">Cash on delivery </label>
                                    <div class="payment-box payment_method_bacs">
                                        <p>Make your payment directly into our bank account. Please use your Order ID as the payment reference.</p>
                                    </div>
                                </div>
                                <div class="pay-top sin-payment sin-payment-3">
                                    <input id="payment-method-4" class="input-radio" type="radio" value="ONLINE" name="payment_method">
                                    <label for="payment-method-4" style="color: black;" >PayPal <img alt="" src="/images/icon-img/payment.png"><a href="#">What is PayPal?</a></label>
                                    <div class="payment-box payment_method_bacs">
                                        <p>Make your payment directly into our bank account. Please use your Order ID as the payment reference.</p>
                                    </div>
                                </div>
                                <div class="pay-top sin-payment sin-payment-3">
                                    <input id="payment-method-4" class="input-radio" type="radio" value="Paypal" name="payment_method">
                                    <label for="payment-method-4" style="color: black;" >PayPal <img alt="" src="/images/icon-img/payment.png"><a href="#">What is PayPal?</a></label>
                                    <div class="payment-box payment_method_bacs">
                                        <p>Make your payment directly into our bank account. Please use your Order ID as the payment reference.</p>
                                    </div>
                                </div>
                            </div>
                            </div>
                          </div>
                      </div>
                    
                    <div class="terms pt-50 pb-20">
                      
                        <div class="order-button">
                            <button type="submit">place order</button>
                        </div>
                      
                    </div>
                </form>
             
                <div class="col-lg-12 col-md-12">
                    <div class="billing-info mb-20 ml-100">
                        <button onclick="addcurrent('<%= users._id %>')"    
                            class="btn btn-outline-warning btn-rounded"
                            data-mdb-ripple-color="dark">Add_address</button>
            
                    </div>
                </div>
                
                    </div>    
                </div>
            </div>
        </div>
    </div>
<!----- Razorpay-- -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
    function addcurrent(Id) {
    console.log(Id);

    $.ajax({
        url: '/getAddAddress/'+Id,
        method: 'get',
        success: (userAddress => {
            console.log(userAddress);
            document.getElementById('fname').value = userAddress.name
            document.getElementById('companyname').value = userAddress.cname
            document.getElementById('streetAddress').value = userAddress.add1
            document.getElementById('town').value = userAddress.town
            document.getElementById('country').value = userAddress.country
            document.getElementById('postcode').value = userAddress.postcode
            document.getElementById('phone').value = userAddress.phone
            document.getElementById('email').value = userAddress.email

        })
    })

}
</script>
<script>
   function verifyPayment(payment,order){
        
        console.log("ppppppppppppppppppppppppppppppphhhhhhhhhhhhhhhhhhhhhhhhhhhhhh");
          $.ajax({
             
            url:'/verifypayment',
            data:{
    
                payment,
                order
            },
            method:'post',
            success:(response)=>{

                if(response.status){

                    location.href='/OrderDetails'
                }else{

                    alert("payment failed")
                }
            }
    
          })
    } 
    $("#checkoutForm").submit((e)=>{
        
        console.log(")))))))))))**********************************");
        e.preventDefault()

        $.ajax({
          
            url:'/place-order',
            method:'post',
            data:$('#checkoutForm').serialize(),
            success:(response)=>{

            if(response.codSuccess){

            location.href='/OrderDetails'
         }else if(response.razorPay){   
               console.log("++++++++++++++++++++++++++++++)))))))))))))))))))");
              razorpayPayment(response)

                }else if(response.payPal){
                     
                    console.log(response,"uuuuuuuuuuuuuuuuuuuuuuuuuuu")
                location.replace(response.linkto)
                }
            }
        })
    })
    function razorpayPayment(order){
          console.log("orderadvvdgvsgvgvgsdv:",order);
        var options = {
    "key": "rzp_test_2fG3822LhxE7px", // Enter the Key ID generated from the Dashboard
    "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
    "currency": "INR",
    "name": "Brototype",
    "description": "Test Transaction",
    "image": "https://example.com/your_logo",
    "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
    "callback_url": "https://eneqd3r9zrjok.x.pipedream.net/",
    "handler": function (response){

          
    verifyPayment(response,order)
  
},
"modal": {
    "ondismiss": function(){
      window.location.replace('https://Gota.gq/payment-failed/'+order.receipt);
    }
},
    "prefill": {
        "name": "Gaurav Kumar",
        "email": "gaurav.kumar@example.com",
        "contact": "9999999999"
    },
    "notes": {
        "address": "Razorpay Corporate Office"
    },
    "theme": {
        "color": "#3399cc"
    }
};
var rzp1 = new Razorpay(options);

    rzp1.open();
    

    }
</script>

<script>
    function checkCoupon() {
        console.log("sknssdsddsdkdck");
            var codes= document.getElementById('code').value
            var Total = document.getElementById('price').value
            console.log(codes)
            console.log(Total);
            $.ajax({
                url: '/checkcoupon',
                data: {
                    data: codes,Total
                     
                },
                method: 'post',
                success: (response => {
                    console.log(response,"$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$");
                    if (response) {
                        document.getElementById('offer').innerHTML = +response
                        document.getElementById("offeramount").value=response
                    } else {
                        document.getElementById('error').innerHTML = 'Enter valied  coupon code'
                    }
                })
            })
        }
</script>
